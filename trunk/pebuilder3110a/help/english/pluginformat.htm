<html>
<head></head>
<body>
<i>PE Builder v3 help</i>
<hr>
<a href="index.htm">Table of contents</a><br>
<h1>Plugin file format</h1>
<br>
<ol>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Createplugin">Creating a plugin</a></li>
<li><a href="#PEBuilder">PEBuilder section</a></li>
<li><a href="#WinntDirectories">WinntDirectories section</a></li>
<li><a href="#SourceDisksFiles">SourceDisksFiles section</a></li>
<li><a href="#SourceDisksFolders">SourceDisksFolders section</a></li>
<li><a href="#Software.AddReg">Software.AddReg section</a></li>
<li><a href="#Software.DelReg">Software.DelReg section</a></li>
<li><a href="#SetupReg.AddReg">SetupReg.AddReg section</a></li>
<li><a href="#Default.AddReg">Default.AddReg section</a></li>
<li><a href="#Default.DelReg">Default.DelReg section</a></li>
<li><a href="#AddLine">AddLine section</a></li>
<li><a href="#DelLine">DelLine section</a></li>
<li><a href="#SetValue">SetValue section</a></li>
<li><a href="#Append">Append section</a></li>
<li><a href="#Variables">Variables</a></li>
</ol>

<a name="Introduction"></a>
<h2>Introduction</h2>

This document should help to create or modify PE Builder plugin files.
The main .inf file for PE Builder is <tt>pebuilder.inf</tt> file.
<b>Please do not edit this file!</b>
If you want to change something use a plugin file.
All plugins are located in the <tt>plugin</tt> directory.
Every .inf file in the <tt>plugin</tt> directory (doesn't matter in which folder) with a 
&quot;pebuilder&quot; section is considered a valid plugin for PE Builder.
Use the Enable/Disable button in the plugin dialog to turn plugins on or off.<br>

<a name="Createplugin"></a>
<h2>Creating a plugin</h2>
A plugin .inf file must be an ascii file, not unicode.
Lines starting with a &quot;;&quot; (semicolon) are ignored (used for comment).<br>
<br>
Every plugin file should start with the lines shown below:<br>
<br>
<table border=1><tr><td><pre>
; PE Builder v3 plug-in INF file
; Created by Bart Lagerweij
; http://www.nu2.nu/pebuilder/
;
; Short description of what the plugin does...

[Version]
Signature= "$Windows NT$"

[PEBuilder]
Name="NiceNameOfPlugin"
Enable=0
Help="pluginhelp.htm"
</pre></td></tr></table>
Please note that you <b>must include</b> the
<tt>[Version] Signature= "$Windows NT$"</tt> information.
Otherwise the setupapi functions cannot open the .inf file.
Please use the information below to add more sections to your plugins...<br>

<a name="PEBuilder"></a>
<h2>PEBuilder section</h2>
If you are creating a plugin, your .inf file <b>must</b> have an [PEBuilder] 
section!<br>
<table border=1>
<tr><td>Name</td><td>the name for the plugin</td></tr>
<tr><td>Enable</td><td>the state of the plugin<br>
0 - Disabled<br>
1 - Enabled<br></td></tr>
<tr><td>Help</td><td>the filename for the plugin helpfile.
This can be a text, html, doc, pdf or any other type of file.
PE Builder uses the ShellExecute() function to start the document with its 
default association.</td></tr>
<tr><td>Config</td><td>the filename for the configuration file.</td></tr>
</table>
<br>

<a name="WinntDirectories"></a>
<h2>WinntDirectories section</h2>
Section WinntDirectories is in the following format:<br>
<tt>directoryID</tt>=dirname[, attribute]</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>directoryID</td><td>is the directory number (id)<br>
In plugin .inf files you can use 'a'-'z' for dynamic number assignment...</td></tr>
<tr><td>dirname</td><td>is the name of the directory. If the name contains spaces put
  double quotes "around it".</td></tr>
<tr><td>attribute</td><td>numeric value to enable/disable some options<br>
value:<br>
1 - Always create this directory (even when empty)<br>
2 - Create directory from (output) root (in <tt>\</tt> and not in <tt>\i386</tt>).<br>
Just add the values to combine...<br>
Default value for attr is 0.</td></tr>
</table>
<br>
Example:<br>
<pre>
[WinntDirectories]
; Always create a folder in the root called "Bart"
a="Bart",3
; Create a folder in the root called "Project\Bart\Source"
b="Project\Bart\Source",3
; Create a folder in the i386 directory called "extra\files"
c="extra\files",1
</pre>
<br>
Here is a list of the (most used) directories ID's:<br>
<table border=1>
<tr><td>ID</td><td>Directory</td><td>Remark</td></tr>
<tr><td>30000</td><td>[root]</td><td>PE Builder output root</td></tr>
<tr><td>1</td><td>\</td><td>SystemRoot (on CD this is the \i386 folder, on hd this is the \minint folder)</td></tr>
<tr><td>2</td><td>system32</td></tr>
<tr><td>3</td><td>system32\config</td></tr>
<tr><td>4</td><td>system32\drivers</td></tr>
<tr><td>5</td><td>system</td></tr>
<tr><td>17</td><td>system32\drivers\etc</td></tr>
<tr><td>20</td><td>inf</td></tr>
<tr><td>21</td><td>Help</td></tr>
<tr><td>22</td><td>Fonts</td></tr>
<tr><td>24</td><td>msagent\intl</td></tr>
<tr><td>52</td><td>msagent</td></tr>
<tr><td>124</td><td>WinSxS</td></tr>
<tr><td>125</td><td>WinSxS\Manifests</td></tr>
<tr><td>252</td><td>WinSxS\Policies</td></tr>
</table>
<br>
PE Builder uses directory id's starting from 30000.
Where id 30000 is used for the output root directory.
30001 and up are dynamically used by PE Builder.<br>

<a name="SourceDisksFiles"></a>
<h2>SourceDisksFiles section</h2>
<tt>SourceDisksFiles[.build]</tt><br>
<br>
This section is used to copy files.
If you add a build number after the section name, that section will only be used 
when the source media is from that build.<br>
<br>
<table border=1>
<tr><th>Build</th><th>Version</th></tr>
<tr><td>2600</td><td>Windows XP</tr>
<tr><td>3790</td><td>Server 2003</tr>
</table>
<br>
The section SourceDisksFiles uses the following format:<br>
<tt>filename=directoryID[, filenameRenamed][, attribute]</tt><br>
<br>
where...<br>
<table border=1>
<tr><td><tt>filename</tt></td><td>is the file to copy.</td></tr>
<tr><td><tt>directoryID</tt></td><td>is the target directory number.
See <a href="#WinntDirectories">WinntDirectories</a> section for a list of
standard windows directory id's.</td></tr>
<tr><td><tt>filenameRenamed</tt></td><td>is the target filename if renaming is needed.</td></tr>
<tr><td><tt>attribute</tt></td><td>numeric value to enable/disable some options<br>
value:<br>
1 - used for pluginCheck(). Make sure that the file exists in the same directory 
as where the .inf file is located, before enabling or continuing.<br>
2 - do not decompress the file.<br>
4 - only copy the file if it exists. Don't complain when it does not exist.<br>
8 - rename the filename to uppercase. When building an ISO image PE Builder 
renames the windows filenames to uppercase (required for booting from CD).<br>
Default value for attribute is 0.<br></td></tr>
</table>
<br>

<a name="SourceDisksFolders"></a>
<h2>SourceDisksFolders section</h2>
<tt>SourceDisksFolders[.build]</tt><br>
<br>
This section is used to copy complete folders and files.
The section SourceDisksFolders uses the following format:<br>
<tt>sourcepath=directoryID</tt><br>
<br>
where...<br>
<table border=1>
<tr><td><tt>sourcepath</tt></td><td>is the source path/folder to copy from.
This is an exact copy nothing is decompressed or extracted!</td></tr>
<tr><td><tt>directoryID</tt></td><td>is the target directory number.
See <a href="#WinntDirectories">WinntDirectories</a> section for a list of
standard windows directory id's.</td></tr>
</table>
<br>
Example:<br>
<pre>
[WinntDirectories]
a="Programs\openoffice",2

[SourceDisksFolders]
; when openoffice folder is in plugin directory
openoffice=a

[SourceDisksFolders]
; when openoffice folder is at c:\
c:\openoffice=a
</pre>

<a name="Software.AddReg"></a>
<h2>Software.AddReg section</h2>
<tt>Software.AddReg[.build]</tt><br>
<br>
Add registry keys to HKEY_LOCAL_MACHINE\SOFTWARE.<br>
This section is in the following format:<br>
<tt>regType, regKey, regValue, regData</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>regType</td><td>specifies the type of information to be stored as the value’s 
data. This parameter can be one of the following values:<br>
0x0, (REG_NONE) create the key only, no value<br>
0x1, (REG_SZ) string<br>
0x2, (REG_EXPAND_SZ) string (with environment variable references)<br>
0x3, (REG_BINARY) binary data<br>
0x4, (REG_DWORD) 32-bit number<br>
0x7, (REG_MULTI_SZ) multiple strings<br>
* Note: <regType> must start with "0x" (lowercase)!</td></tr>
<tr><td>regKey</td><td>specifies the name of the key as string.</td></tr>
<tr><td>regValue</td><td>specfies the name of the value as string.</td></tr>
<tr><td>regData</td><td>The actual data.</td></tr>
</table>
<br>
Example:<br>
<pre>
0x1, &quot;Microsoft\Windows NT\CurrentVersion\Fonts&quot;, &quot;Tahoma (TrueType)&quot;,&quot;TAHOMA.TTF&quot;
0x2, &quot;Control Panel\desktop&quot;, &quot;WallPaper&quot;, &quot;%systemroot%\system32\nu2.bmp&quot;
0x3, &quot;ControlSet001\Control\TimeZoneInformation&quot;, &quot;DaylightStart&quot;,\
	00,00,04,00,00,01,00,02,00,00,00,00,00,00,00,00
0x4, &quot;ControlSet001\Control\GraphicsDrivers\DCI&quot;, &quot;Timeout&quot;, 0x7
0x7, &quot;ControlSet001\Services\VgaSave\Device0&quot;, &quot;InstalledDisplayDrivers&quot;,&quot;vga&quot;, &quot;framebuf&quot;, &quot;vga256&quot;, &quot;vga64k&quot;
</pre>

<a name="SetupReg.AddReg"></a>
<h2>SetupReg.AddReg section</h2>
<tt>SetupReg.AddReg[.build]</tt><br>
<br>
Add registry keys to the "SetupReg.hiv" registry hive.
Same syntax as <a href="#Software.AddReg">Software.AddReg</a><br>

<a name="Default.AddReg"></a>
<h2>Default.AddReg section</h2>
<tt>Default.AddReg[.build]</tt><br>
<br>
Add registry keys to HKEY_CURRENT_USER.<br>
Same syntax as <a href="#Software.AddReg">Software.AddReg</a><br>

<a name="Software.DelReg"></a>
<h2>Software.DelReg section</h2>
<tt>Software.DelReg[.build]</tt><br>
<br>
Delete registry keys from the "Software" registry hive.
This section is in the following format:
<tt>regKey[, regValue]</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>regKey</td><td>specifies the name of the key (including all values) to delete
as string.</td></tr>
<tr><td>regValue</td><td>specifies the name of the value to delete as string.</td></tr>
</table>

<a name="Default.DelReg"></a>
<h2>Default.DelReg section</h2>
<tt>Default.DelReg[.build]</tt><br>
<br>
Delete registry keys from the "Default" registry hive.
Same syntax as <a href="#Software.DelReg">Software.DelReg</a><br>
  
<a name="AddLine"></a>
<h2>AddLine section</h2>
<tt>AddLine[.build]</tt><br>
<br>
Adding lines to a section.
The lines in the AddLine section have the following format:<br>
<tt>Filename,Section,StringToAdd</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>Filename</td><td>is the filename to add a line to.</td></tr>
<tr><td>Section</td><td>is the sectionname.</td></tr>
<tr><td>LineToAdd</td><td>is the line to add.</td></tr>
</table>
<br>
Example:<br>
&quot;netmscli.inf&quot;, &quot;MSClient.DelReg&quot;, &quot;HKLM, Software\Microsoft\Rpc\SecurityService, 9&quot;

<a name="DelLine"></a>
<h2>DelLine section</h2>
<tt>DelLine[.build]</tt><br>
<br>
Delete lines from file.
The lines in the DelLine section have the following format:<br>
<tt>Filename,Section,StringToDel</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>Filename</td><td>is the filename to add a line to.</td></tr>
<tr><td>Section</td><td>is the sectionname.</td></tr>
<tr><td>StringToDel</td><td>is the line to delete. You don't have to match exact, 
any lines begining with &quot;StringToDel&quot; will be deleted.</td></tr>
</table>
<br>
Example:<br>
&quot;netmscli.inf&quot;, &quot;MSClient.Browser.AddReg&quot;, &quot;HKR, Parameters, MaintainServerList,&quot;

<a name="SetValue"></a>
<h2>SetValue section</h2>
<tt>SetValue[.build]</tt><br>
<br>
Write value to file.
The lines in the SetValue section have the following format:<br>
<tt>Filename,Section,Key,Value</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>Filename</td><td>is the filename to set a value in.</td></tr>
<tr><td>Section</td><td>is the sectionname.</td></tr>
<tr><td>Key</td><td>is the key to assign a value to.</td></tr>
<tr><td>Value</td><td>is the data.</td></tr>
</table>
<br>
Example:<br>
&quot;netmscli.inf&quot;, &quot;Alerter_Service_Inst&quot;, &quot;StartType&quot;, &quot;3&quot;<br>
<br>
Use <tt>Filename,Section,Key</tt> to remove a key<br>
Use <tt>Filename,Section</tt> to remove a complete section<br>

<a name="Append"></a>
<h2>Append section</h2>
<tt>Append[.build]</tt><br>
<br>
Append a file to another file.
The lines in the Append section have the following format:<br>
<tt>Filename,FilenameToAppend</tt><br>
<br>
where...<br>
<table border=1>
<tr><td>Filename</td><td>is the file where data will be appended.</td></tr>
<tr><td>FilenameToAppend</td><td>is the file that contain the data to append.</td></tr>
</table>
<br>
Example:<br>
<tt>nu2menu.xml, penero_nu2menu.xml</tt>

<a name="Variables"></a>
<h2>Variables</h2>
Most string fields in the plugin file can have some special PE-Builder variables:<br>
Syntax: <tt>@variable@</tt><br>
<br>
where...<br>
<table border=1>
<tr><th>variable</th><th>expands to...</th></tr>
<tr><td>Program</td><td>The name of the builder (PE-Builder by default)</td></tr>
<tr><td>Version</td><td>The builder version</td></tr>
<tr><td>IsoFile</td><td>Full path and filename of ISO image</td></tr>
<tr><td>OutDir</td><td>Full path of output directory</td></tr>
<tr><td>SourcePath</td><td>Full path of source directory</td></tr>
<tr><td>PluginDir</td><td>Full path of the current plugin directory</td></tr>
<tr><td>PluginFile</td><td>Full path and filename of the current plugin file</td></tr>
<tr><td>Language</td><td>The current language</td></tr>
<tr><td>Verbose</td><td>Verbose mode (0 means off, 1 means on)</td></tr>
<tr><td>Build</td><td>The windows build number (2600 means XP, 3790 means server 2003)</td></tr>
</table>
<br>
Example:<br>
<tt>[SourceDisksFiles]</tt><br>
<tt>program.exe=2,,3</tt><br>
<tt>lang\@language@.lng=2,,3</tt><br>
<br>
Where <tt>lang\@language@.lng</tt> will get expanded to <tt>lang\german.lng</tt> (when german language is selected).<br>

<br>
<a href="index.htm">Table of contents</a><br>
<hr>
<i>PE Builder Copyright (c) 2002-2006 Bart Lagerweij. All rights reserved.</i><br>
</body>
</html>
